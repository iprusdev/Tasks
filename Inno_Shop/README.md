# InnoShop

Проект представляет собой систему из двух микросервисов (**Identity** и **Products**), разработанную с использованием **Clean Architecture** и упакованную в **Docker**.

## Запуск проекта

1.  **Запуск одной командой:**

    ```bash
    docker-compose up --build
    ```

2.  **Доступ к сервисам:**
    После успешного запуска сервисы будут доступны по адресам:

    | Сервис           | Адрес Swagger                   | Описание                    |
    | :--------------- | :------------------------------ | :-------------------------- |
    | **Identity API** | `http://localhost:5001/swagger` | Регистрация, Логин, Админка |
    | **Products API** | `http://localhost:5002/swagger` | Товары (Требует токен)      |
    | **Frontend**     | `index.html`                    |                             |

---

## Инструкция по использованию

После запуска контейнеров (`docker-compose up`), выполните следующие шаги для проверки системы:

### 1. Регистрация и Вход (Identity Service)

1.  Откройте **Identity Swagger**: `http://localhost:5001/swagger`
2.  Найдите метод `POST /api/auth/register`.
3.  Нажмите **Try it out** и отправьте JSON:
    ```json
    {
      "name": "Test User",
      "email": "user@example.com",
      "password": "Password123!"
    }
    ```
4.  **Подтверждение почты**:
    - Зайдите на сайт [ethereal.email](https://ethereal.email/) (используя логин/пароль из `appsettings.json` или логов консоли). Или создайте новый и замените appsettings если время вышло.
    - Найдите письмо и перейдите по ссылке подтверждения.
5.  **Вход (Login)**:
    - Вызовите метод `POST /api/auth/login` с теми же данными.
    - Скопируйте полученный **token** (длинная строка) из ответа.

### 2. Работа с товарами (Products Service)

1.  Откройте **Products Swagger**: `http://localhost:5002/swagger`
2.  **Авторизация**:
    - Нажмите зеленую кнопку **Authorize** .
    - Введите токен в формате: `Bearer ВАШ_ТОКЕН`.
    - Нажмите **Authorize** -> **Close**.
3.  **Создание товара**:
    - Вызовите метод `POST /api/products`.
    - JSON:
      ```json
      {
        "name": "MacBook Pro",
        "description": "Super laptop",
        "price": 2000
      }
      ```
    - Если всё настроено верно, товар создастся и привяжется к вашему `UserId`.

### 3. Сценарий "Злой Админ"

Чтобы проверить связь микросервисов:

1.  **Стать Админом**:
    - Вам нужно вручную выдать себе роль. Выполните команду в терминале (пока контейнеры запущены):
    ```bash
    docker exec -it innoshop_db psql -U admin -d InnoShop_Identity -c "UPDATE \"Users\" SET \"Role\" = 'Admin' WHERE \"Email\" = 'user@example.com';"
    ```
2.  **Получить новый токен**:
    - Сделайте Login заново, чтобы в токене обновилась роль на `Admin`.
3.  **Забанить пользователя**:
    - В Identity Swagger (с токеном админа!) найдите метод `PUT /api/users/{id}/status`.
    - Вставьте ID пользователя и в теле запроса `false` (или `isVisible=false` в зависимости от реализации).
4.  **Проверка**:
    - Перейдите в Products Swagger.
    - Вызовите `GET /api/products`.
    - Товары этого пользователя должны **исчезнуть** из списка (так как он забанен).

---

## Тестирование

Для запуска тестов локально:

```bash
dotnet test

```

Или в VS перейдите во вкладку Test Run All Tests
